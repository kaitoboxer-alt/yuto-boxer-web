<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Card Viewer - yuto-boxer.com</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@700&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; padding: 20px; background-color: #222; color: #fff; 
            font-family: 'Zen Maru Gothic', sans-serif; text-align: center; 
        }
        .container { max-width: 900px; margin: 0 auto; background: #333; padding: 20px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { font-size: 1.2rem; margin-bottom: 20px; color: #00f0ff; }
        
        canvas { width: 100%; height: auto; border-radius: 8px; background: #000; margin-bottom: 20px; }
        
        .info { text-align: left; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; font-size: 0.9rem; line-height: 1.6; }
        .btn-download { 
            display: inline-block; margin-top: 20px; padding: 12px 25px; 
            background: #ff4500; color: #fff; text-decoration: none; 
            font-weight: bold; border-radius: 6px; cursor: pointer; border: none;
        }
        .btn-download:hover { background: #cc3700; }
    </style>
</head>
<body>

<div class="container">
    <h1>Message Card Viewer</h1>
    
    <canvas id="adminCanvas" width="1280" height="720"></canvas>
    
    <div class="info" id="infoPanel">
        ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªä¸­...
    </div>
    
    <button class="btn-download" onclick="downloadImage()">ã“ã®ç”»åƒã‚’ä¿å­˜ã™ã‚‹ ğŸ’¾</button>
</div>

<script>
    const canvas = document.getElementById('adminCanvas');
    const ctx = canvas.getContext('2d');
    const infoPanel = document.getElementById('infoPanel');

    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
    const params = new URLSearchParams(window.location.search);
    const imgUrl = params.get('img');
    const message = params.get('text');

    if (!imgUrl || message === null) {
        infoPanel.innerHTML = "âŒ ã‚¨ãƒ©ãƒ¼: ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã‚’å†åº¦ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
    } else {
        loadAndDraw();
    }

    function loadAndDraw() {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = function() {
            // èƒŒæ™¯ç”»åƒã‚’æç”»
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            
            // ãƒ†ã‚­ã‚¹ãƒˆã‚’æç”»
            ctx.fillStyle = "#333333";
            ctx.font = "bold 44px 'Zen Maru Gothic', sans-serif";
            ctx.textBaseline = "top";

            const lines = message.split('\n');
            lines.forEach((line, i) => {
                ctx.fillText(line, 220, 150 + (i * 55));
            });

            infoPanel.innerHTML = `<strong>ã€å—ä¿¡å†…å®¹ã€‘</strong><br>ã‚«ãƒ¼ãƒ‰URL: ${imgUrl}<br>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${message.replace(/\n/g, ' / ')}`;
        };
        img.onerror = function() {
            infoPanel.innerHTML = "âŒ ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚URLã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
        };
        img.src = imgUrl;
    }

    function downloadImage() {
        const link = document.createElement('a');
        link.download = `Received_Message_${new Date().getTime()}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
    }
</script>

</body>
</html>