<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>éƒ¨å®¤ - yuto-boxer.com</title>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@700&display=swap" rel="stylesheet">
<style>
    body {
        margin: 0; padding: 0; height: 100vh; background-color: #000; 
        background-image: url('https://media.yuto-boxer.com/02_clubroom/clubroom.webp'); 
        background-size: cover; background-position: left center; 
        font-family: 'Helvetica Neue', Arial, sans-serif;
        overflow: hidden; display: flex; flex-direction: column; justify-content: space-between;
    }
    .menu-area { position: absolute; right: 8%; top: 15%; display: flex; flex-direction: column; gap: 20px; width: 250px; z-index: 100; }
    .gunmetal-btn {
        display: block; position: relative;
        background: repeating-linear-gradient(to bottom, transparent, transparent 2px, rgba(0,0,0,0.1) 2px, rgba(0,0,0,0.1) 4px), linear-gradient(135deg, #444, #222);
        color: #fff; text-decoration: none; padding: 15px 25px; font-weight: bold; text-align: center; border: 2px solid #555; border-radius: 4px;
        transition: all 0.3s ease; font-size: 1.1rem; letter-spacing: 2px; text-shadow: 1px 1px 2px #000;
    }
    .gunmetal-btn:hover { border-color: #00f0ff; box-shadow: 0 0 15px rgba(0,240,255,0.5); transform: scale(1.05); }
    .gunmetal-btn::after {
        content: attr(data-comment); position: absolute; right: 105%; top: 50%; transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.8); color: #00f0ff; padding: 6px 12px; border-radius: 4px; border: 1px solid #00f0ff;
        font-size: 0.9rem; white-space: nowrap; opacity: 0; visibility: hidden; transition: 0.3s; pointer-events: none;
    }
    .gunmetal-btn:hover::after { opacity: 1; visibility: visible; }

    .floating-send-btn {
        position: fixed; bottom: 20px; right: 20px; background: rgba(0, 240, 255, 0.15); border: 1px solid #00f0ff;
        color: #00f0ff; padding: 12px 24px; text-decoration: none; font-size: 0.95rem; font-weight: bold; border-radius: 30px; 
        transition: all 0.3s; z-index: 200; backdrop-filter: blur(5px); cursor: pointer;
    }
    .floating-send-btn:hover { background: #00f0ff; color: #000; box-shadow: 0 0 15px #00f0ff; }

    .dialogue-box { position: absolute; bottom: 15%; left: 5%; width: 60%; background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.1); padding: 20px; color: #ddd; font-size: 1.2rem; cursor: pointer; z-index: 50; }
    .name-g { color: #88ccff; font-weight: bold; } .name-b { color: #ffcc88; font-weight: bold; }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨CSS */
    .modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.4s ease; z-index: 10000; backdrop-filter: blur(5px); }
    .modal.active { opacity: 1; pointer-events: auto; }
    .modal-content { width: 80%; max-width: 600px; border-radius: 8px; overflow: hidden; text-align: left; position: relative; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8); display: flex; flex-direction: column; max-height: 90vh; }
    .modal-header { background-color: #111111; color: #ffffff; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255, 255, 255, 0.2); }
    .modal-title { margin: 0; font-size: 1.2rem; letter-spacing: 2px; font-weight: bold; }
    .close-btn { font-size: 1.8rem; cursor: pointer; opacity: 0.7; transition: opacity 0.3s; line-height: 1; }
    .close-btn:hover { opacity: 1; }
    .text-content { padding: 30px 40px; line-height: 1.8; font-size: 0.95rem; overflow-y: auto; }

    #modal-generator .modal-content { max-width: 700px; }
    #modal-generator .text-content { background-color: rgba(255, 255, 255, 0.95); color: #333; padding: 15px 25px; }
    #modal-generator h3 { font-size: 1rem; margin-top: 0; margin-bottom: 8px; border-bottom: 2px solid #333; padding-bottom: 3px; }
    .gen-canvas-container { margin-bottom: 10px; border-radius: 8px; overflow: hidden; background: #eee; }
    .gen-canvas-container canvas { width: 100%; height: auto; display: block; }
    .gen-textarea { width: 100%; box-sizing: border-box; height: 70px; padding: 8px; font-size: 14px; border: 2px solid #ccc; border-radius: 6px; font-family: 'Zen Maru Gothic', inherit; resize: vertical; margin-bottom: 10px; }
    .gen-buttons { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 5px; }
    .gen-btn { background-color: #333; color: white; border: none; padding: 8px 16px; font-size: 13px; font-weight: bold; border-radius: 6px; cursor: pointer; transition: 0.2s; }
    .gen-btn:hover { background-color: #000; }
    .gen-btn-dl { background-color: #ff4500; }
    .gen-btn-dl:hover { background-color: #cc3700; }
    .gen-btn-submit { background-color: #28a745; width: 100%; padding: 12px; font-size: 16px; color: white; border: none; font-weight: bold; border-radius: 6px; cursor: pointer; }
    .gen-btn-submit:hover { background-color: #218838; }
    .gen-hr { margin: 12px 0; border: 0; border-top: 1px dashed #ccc; } 
    .reply-notice { font-size: 12px; color: #444; margin-top: 10px; text-align: left; line-height: 1.4; background-color: #f8f9fa; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
    .reply-notice a { color: #1da1f2; text-decoration: none; font-weight: bold; }
</style>
</head>
<body>
    <div class="menu-area">
        <a href="../Gallery/index.html" class="gunmetal-btn" data-comment="ã‚®ãƒ£ãƒ©ãƒªãƒ¼">Gallery</a>
        <a href="../Novel/index.html" class="gunmetal-btn" data-comment="å°èª¬">Novel</a>
        <a href="../Youthful_Moments/index.html" class="gunmetal-btn" data-comment="é§†ã‘æŠœã‘ã‚‹é’æ˜¥ã®è¼ã">YouthfulMoments</a>
        <a href="../Downloads/index.html" class="gunmetal-btn" data-comment="ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰">Download</a>
        <a href="../pressrelease/index.html" class="gunmetal-btn" data-comment="ãƒœã‚¯ã‚·ãƒ³ã‚°ãƒªãƒ¼ã‚°çµæœ">Press Release</a>
        <a href="../yuto-room/index.html" class="gunmetal-btn" data-comment="ã‚†ãƒ¼ã¨ã®å¼•ãç± ã‚‚ã‚Šéƒ¨å±‹">Yuto's Room</a>
    </div>

    <a onclick="openGeneratorModal()" class="floating-send-btn">Send Message</a>

    <div class="dialogue-box" id="dialogue-box"></div>

    <div id="modal-generator" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2 class="modal-title">Send Message</h2><span class="close-btn" onclick="closeGeneratorModal()">Ã—</span></div>
            <div class="text-content">
                <h3 style="margin-top:0;">â—† ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ</h3>
                <div class="gen-canvas-container">
                    <canvas id="myCanvas" width="1280" height="720"></canvas>
                </div>
                <div class="gen-buttons">
                    <button class="gen-btn" type="button" onclick="changeRandomCard()">ã‚­ãƒ£ãƒ©ã‚’å¤‰ãˆã‚‹ğŸ²</button>
                    <button class="gen-btn gen-btn-dl" type="button" onclick="downloadCard()">ã“ã®ç”»åƒã‚’ä¿å­˜ğŸ’¾</button>
                </div>
                <hr class="gen-hr">
                <h3 style="margin-top:0;">â—† ã‚†ãƒ¼ã¨ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹</h3>
                <form id="myForm" action="https://formspree.io/f/xeelvqye" method="POST">
                    <input type="hidden" id="selectedCardUrl" name="Selected_Character_URL" value="">
                    <input type="hidden" id="adminMagicLink" name="Admin_Magic_Link" value="">
                    <textarea id="cardInput" name="message" class="gen-textarea" required placeholder="ã“ã“ã«å¿œæ´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„è³ªå•ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ä¸Šã®ã‚«ãƒ¼ãƒ‰ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›¸ãè¾¼ã¾ã‚Œã¾ã™ï¼"></textarea>
                    <button type="submit" class="gen-btn-submit">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ ğŸš€</button>
                    <div class="reply-notice">
                        â€»ãŠè¿”äº‹ã§ãã‚‹ã¨ãã¯Xï¼ˆæ—§Twitterï¼‰ã® <a href="https://x.com/boxer_yuto" target="_blank" rel="noopener noreferrer">@boxer_yuto</a> ã‹ã‚‰ã«ãªã‚Šã¾ã™ã€‚<br>
                    </div>
                </form>
            </div>
        </div>
    </div>

<script>
    // â–¼ éƒ¨å®¤ã®ä¼šè©±ã‚¹ã‚¯ãƒªãƒ—ãƒˆ â–¼
    const convs = [
        `<span class="name-g">å­¦ãƒ©ãƒ³:</span>ã€Œãªãã€ä»Šæ—¥ã®éƒ¨æ´»ã®å¾Œã€ãƒ©ãƒ¼ãƒ¡ãƒ³è¡Œã‹ã­ï¼Ÿã€<br><span class="name-b">ãƒ–ãƒ¬ã‚¶ãƒ¼:</span>ã€Œâ€¦å›ã¯æ¸›é‡ã¨ã„ã†è¨€è‘‰ã‚’çŸ¥ã‚‰ãªã„ã®ã‹ã„ï¼Ÿ ã¾ãã€ä»˜ãåˆã†ã‘ã©ã€‚ã€`,
        `<span class="name-g">å­¦ãƒ©ãƒ³:</span>ã€Œè¦‹ã‚ã‚ˆã‚ã®ãƒªãƒ³ã‚°ã®å…‰ã€‚â€¦ã‚¾ã‚¯ã‚¾ã‚¯ã—ã­ã‡ã‹ï¼Ÿã€<br><span class="name-b">ãƒ–ãƒ¬ã‚¶ãƒ¼:</span>ã€Œã‚ã‚ã€‚é™ã‹ã ãŒã€ç¢ºã‹ã«ç†±ã‚’å¸¯ã³ã¦ã„ã‚‹ã­ã€‚ã€`
    ];
    let i = 0; const b = document.getElementById('dialogue-box');
    function s() { b.innerHTML = convs[i]; i = (i + 1) % convs.length; }
    b.onclick = s; s();

    // â–¼ é€ä¿¡ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆä¿®æ­£ç‰ˆï¼‰ â–¼
    function openGeneratorModal() {
        document.getElementById('modal-generator').classList.add('active');
        changeRandomCard();
    }
    function closeGeneratorModal() { document.getElementById('modal-generator').classList.remove('active'); }
    window.onclick = function(event) { if (event.target.classList.contains('modal')) event.target.classList.remove('active'); };

    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');
    const cardInput = document.getElementById('cardInput');
    let currentImage = new Image();

    cardInput.addEventListener('input', drawCard);

    function changeRandomCard() {
        const currentCardNumber = Math.floor(Math.random() * 20) + 1;
        // æ¡æ•°ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£ (padStartã‚’2ã«å¤‰æ›´)
        const paddedNum = String(currentCardNumber).padStart(2, '0');
        const imageUrl = `https://media.yuto-boxer.com/card/card_${paddedNum}.png`;

        document.getElementById('selectedCardUrl').value = imageUrl;

        currentImage = new Image();
        currentImage.crossOrigin = "anonymous";
        currentImage.onload = () => drawCard();
        // ç”»åƒã‚¨ãƒ©ãƒ¼æ™‚ã§ã‚‚æ–‡å­—å…¥åŠ›ã‚’ãƒ•ãƒªãƒ¼ã‚ºã•ã›ãªã„å®‰å…¨è£…ç½®
        currentImage.onerror = () => { console.error("ç”»åƒèª­è¾¼ã‚¨ãƒ©ãƒ¼: " + imageUrl); drawCard(); };
        currentImage.src = imageUrl + "?t=" + new Date().getTime();
    }

    function drawCard() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // ç”»åƒãŒæ­£å¸¸ãªã‚‰æç”»ã€ãƒ€ãƒ¡ãªã‚‰æš—ã„èƒŒæ™¯ã‚’æ•·ã
        if (currentImage.complete && currentImage.naturalWidth !== 0) {
            ctx.drawImage(currentImage, 0, 0, canvas.width, canvas.height);
        } else {
            ctx.fillStyle = "#222222";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        const text = cardInput.value;
        if (text.trim() !== "") {
            const textArea = { x:220, y: 90, width: 720, height: 500 };
            drawTextWithAutoScale(ctx, text, textArea);
        }

        const currentUrl = document.getElementById('selectedCardUrl').value;
        const magicLinkInput = document.getElementById('adminMagicLink');
        if (magicLinkInput) {
            const magicUrl = `https://yuto-boxer.com/admin_maker.html?img=${encodeURIComponent(currentUrl)}&text=${encodeURIComponent(text)}`;
            magicLinkInput.value = magicUrl;
        }
    }

    function drawTextWithAutoScale(ctx, text, area) {
        let fontSize = 54;
        const minFontSize = 24;
        const fontFamily = "'Zen Maru Gothic', 'Hiragino Maru Gothic ProN', sans-serif";
        const lineHeightRatio = 1.4;
        let lines = [];
        let wrappedText = text.replace(/\r\n/g, '\n');
        
        document.fonts.ready.then(() => {
            while (fontSize >= minFontSize) {
                ctx.font = `bold ${fontSize}px ${fontFamily}`;
                lines = wrapText(ctx, wrappedText, area.width);
                if (lines.length * (fontSize * lineHeightRatio) <= area.height) break;
                fontSize -= 2;
                
                if (fontSize < minFontSize) {
                    fontSize = minFontSize;
                    ctx.font = `bold ${fontSize}px ${fontFamily}`;
                    lines = wrapText(ctx, wrappedText, area.width);
                    const maxLines = Math.floor(area.height / (fontSize * lineHeightRatio));
                    lines = lines.slice(0, maxLines);
                    if (lines.length > 0) {
                        let lastLine = lines[lines.length - 1];
                        lines[lines.length - 1] = lastLine.length > 2 ? lastLine.slice(0, -2) + "â€¦" : lastLine + "â€¦";
                    }
                    break;
                }
            }
            ctx.fillStyle = "#333333";
            ctx.textBaseline = "top";
            const totalTextHeight = lines.length * (fontSize * lineHeightRatio);
            const startY = area.y + (area.height - totalTextHeight) / 2;
            lines.forEach((line, index) => {
                ctx.fillText(line, area.x, startY + index * (fontSize * lineHeightRatio));
            });
        });
    }

    function wrapText(ctx, text, maxWidth) {
        const kinsokuStart = "ã€ã€‚ï¼Œï¼ãƒ»ï¼šï¼›ï¼Ÿï¼ã‚›ã‚œÂ´ï½€Â¨ï¼¾â€•â€ï¼ï¼¼ï½âˆ¥ï½œâ€¦â€¥â€˜â€™â€œâ€ï¼ˆï¼‰ã€”ã€•ï¼»ï¼½ï½›ï½ã€ˆã€‰ã€Šã€‹ã€Œã€ã€ã€ã€ã€‘";
        const chars = text.split('');
        let lines = [], currentLine = '';
        for (let i = 0; i < chars.length; i++) {
            const char = chars[i];
            if (char === '\n') { lines.push(currentLine); currentLine = ''; continue; }
            const testLine = currentLine + char;
            if (ctx.measureText(testLine).width > maxWidth && currentLine !== '') {
                if (kinsokuStart.includes(char)) { currentLine = testLine; }
                else { lines.push(currentLine); currentLine = char; }
            } else { currentLine = testLine; }
        }
        lines.push(currentLine);
        return lines;
    }

    function downloadCard() {
        const link = document.createElement('a');
        link.download = `Message_card_${new Date().getTime()}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
    }

    const form = document.getElementById('myForm');
    form.addEventListener('submit', function(event) {
        event.preventDefault(); 
        fetch(form.action, { method: form.method, body: new FormData(form), headers: { 'Accept': 'application/json' } })
        .then(response => {
            if (response.ok) {
                alert("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼");
                form.reset(); drawCard(); closeGeneratorModal(); 
            } else { alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"); }
        })
        .catch(() => alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"));
    });
</script>
</body>
</html>